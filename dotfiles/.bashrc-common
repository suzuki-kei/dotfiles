#!/bin/bash

# ------------------------------------------------------------------------------
#  Bash Settings (general)
# ------------------------------------------------------------------------------

export TZ='Asia/Tokyo'
export PAGER=less
export EDITOR=vi
export PS1='$ '

shopt -s extglob

# ------------------------------------------------------------------------------
#  Bash Settings (history command)
# ------------------------------------------------------------------------------

export HISTSIZE=7777777
export HISTFILESIZE=7777777
export HISTTIMEFORMAT="%Y-%m-%d %T "
export HISTCONTROL=ignoredups

# ------------------------------------------------------------------------------
#  Aliases (ls command)
# ------------------------------------------------------------------------------

alias ls='\ls --color=never --time-style=long-iso'
alias l='ls -1F'
alias ll='ls -lhF'
alias la='ll -a'

# ------------------------------------------------------------------------------
#  Go
# ------------------------------------------------------------------------------

if $(which go > /dev/null); then
    export GOPATH=$(go env GOPATH)
    export PATH="$GOPATH/bin:$PATH"
fi

# ------------------------------------------------------------------------------
#  Custom Commands
# ------------------------------------------------------------------------------

export PATH="$(cd $(dirname "${BASH_SOURCE}")/.. && pwd)/scripts:$PATH"

# クリップボードとコマンド履歴を消去する.
function clear.history
{
    history -cw

    if $(which pbcopy > /dev/null); then
        echo -n | pbcopy
    fi

    if $(screen -ls | grep -F '(Attached)' > /dev/null); then
        local -r sockname=$(screen -ls | grep -F "(Attached)" | cut -f2)
        screen -S "${sockname}" -X scrollback 0
        screen -S "${sockname}" -X source ~/.screenrc
        screen -S "${sockname}" -X register . ''
    fi

    \clear
}

# date の出力形式を変更する.
function date_with_defaults
{
    if [ $# == 0 ]; then
        date "+%Y-%m-%d %H:%M:%S %Z"
    else
        date "$@"
    fi
}
alias date=date_with_defaults

# screen の重複実行を防止する.
function screen_with_double_execution_prevention
{
    if [[ $# == 0 && "${TERM}" == "screen" ]]; then
        echo "screen is already running."
    else
        \screen "$@"
    fi
}
alias screen=screen_with_double_execution_prevention

#
# screen のウィンドウを使い捨てにして Chrome を起動するためのショートカット.
#
# scripts/g を実行後に exit する.
#     1. Chrome を起動するために g を実行する.
#     2. exit で screen のウィンドウを破棄する.
#
function g.exit
{
    g "$@"
    exit
}

#
# ディレクトリを作成後, その中に移動する.
#
function mkcd
{
    if [[ "$1" = '' ]]; then
        echo 'Invalid options: DIRECTORY must be specified.'
        return 1
    fi

    mkdir -p "$1" && cd "$1"
}

